<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;

            width: 100%;
            height: 100%;

            background-color: gray;
        }

        .main-container {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <script type="module" src="../../index.js"></script>
    <div class="main-container"></div>

    <script type="module">
        const mockData = [
            "../../../../assets/imgs/other/WIKI攻略.png",
            "../../../../assets/imgs/other/官方周边.png",
            "../../../../assets/imgs/other/官方漫画.png",
            "../../../../assets/imgs/other/官方周边.png",
            "../../../../assets/imgs/other/WIKI攻略.png",
            "../../../../assets/imgs/home-bg.png",
        ];
        const container = document.querySelector(".main-container");
        let prevNode = container.children[container.children.length - 1] || container;
        let index = 0;

        const loadItem = (observer, root) => {
            observer.unobserve(prevNode);

            try {
                const urls = [];
                const end = index + 5;
                for (let i = index; i < end; i++, index++) {
                    if (!mockData[i]) break;

                    urls.push(mockData[i]);
                }

                if (!urls.length) throw new Error();


                const item = document.createElement("gr-picture");
                item.addEventListener("gr-picture-load", () => {
                    item.pictures = urls;
                });
                root.appendChild(item);

                prevNode = root.children[root.children.length - 1];
                observer.observe(prevNode);
            } catch (error) {
                observer.disconnect();
                document.dispatchEvent(new CustomEvent("gr-picture-render-finished"));
            }
        }
        const observer = new IntersectionObserver((entries) => {
            if (entries[0].intersectionRatio <= 0) return;

            loadItem(observer, container);
        });
        observer.observe(prevNode);

        document.addEventListener("gr-picture-render-finished", () => {
            console.log(1);
        })
    </script>
</body>

</html>